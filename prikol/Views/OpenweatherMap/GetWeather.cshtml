
@{
    ViewBag.Title = "GetWeather";
}


<style type='text/css'>
    .ui-menu .ui-menu-item a, .ui-menu .ui-menu-item a.ui-state-hover, .ui-menu .ui-menu-item a.ui-state-active {
        font-weight: normal;
        margin: -1px;
        text-align: left;
        font-size: 14px;
    }

    .ui-autocomplete-loading {
        background: white url("/images/ui-anim_basic_16x16.gif") right center no-repeat;
    }
</style>

<h2>GetWeather</h2>

<div style="display:flex">
    <p style="padding-right:10px">Dark theme</p>
    <input type="checkbox" id="night" />
</div>

<div style="display:flex;justify-content:space-around">
    <div>
        <a id="Ref" href="~/OpenweatherMap/getWeatherForCurrCity/">Current location</a>
        <br />
        <label>Get Weather for 5 days</label>
        <form id="weather4Days" method="post" action="/OpenweatherMap/getWeather5days" enctype="multipart/form-data">
            <input type="text" name="city5days" id="textBox5days" class="ff_elem" value="">

            <input type="submit" value="Get weather" />
        </form>
        <div id="result2">
        </div>
    </div>

    <div>
        <br />
        <label>Get current weather</label>
        <form id="formCity" method="post" action=""  enctype="multipart/form-data">
            <input type="text" name="city" id="textBox" class="ff_elem" value="">
            <input type="submit" value="Get weather" />
        </form>
        <div id="result">
        </div>
    </div>


    <div>
        <p>Weather Maps</p>
        <ul>
            <li style="padding:5px">
                <button class="weatherMap">Clouds map</button>
            </li>
            <li style="padding:5px">
                <button class="weatherMap">Precipitation map</button>
            </li>
            <li style="padding:5px">
                <button class="weatherMap">Sea level pressure map</button>
            </li>
            <li style="padding:5px">
                <button class="weatherMap">Wind speed map</button>
            </li>
            <li style="padding:5px">
                <button class="weatherMap">Temperature map</button>
            </li>
        </ul>
    </div>
</div>

@*<script src="~/Scripts/JQuery-3.3.1.js"></script>*@
<link href='@Url.Content("~/Content/themes/base/all.css")' rel="stylesheet" type="text/css" />

<script src='@Url.Content("~/Scripts/jquery-3.3.1.js")' type="text/javascript"></script>
<script src='@Url.Content("~/Scripts/jquery-ui-1.12.1.js")' type="text/javascript"></script>

@*<script src='@Url.Content("~/Scripts/jquery-ui-1.12.1.js")' type="text/javascript"></script>*@
<script type="text/javascript">

    $(function () {
        $("#textBox5days").autocomplete({
            source: function (request, response) {
                $.getJSON(
                    "https://secure.geobytes.com/AutoCompleteCity?key=7c756203dbb38590a66e01a5a3e1ad96&callback=?&q=" + request.term,
                    function (data) {
                        response(data);
                    }
                );
            },
            minLength: 3,
            select: function (event, ui) {
                var selectedObj = ui.item;
                $("#textBox5days").val(selectedObj.value);
                //getcitydetails(selectedObj.value);
                return false;
            },
            open: function () {
                $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
            },
            close: function () {
                $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
            }
        });
        $("#textBox5days").autocomplete("option", "delay", 100);
    });

        $(function () {
        $("#textBox").autocomplete({
            source: function (request, response) {
                $.getJSON(
                    "https://secure.geobytes.com/AutoCompleteCity?key=7c756203dbb38590a66e01a5a3e1ad96&callback=?&q=" + request.term,
                    function (data) {
                        response(data);
                    }
                );
            },
            minLength: 3,
            select: function (event, ui) {
                var selectedObj = ui.item;
                $("#textBox").val(selectedObj.value);
                //getcitydetails(selectedObj.value);
                return false;
            },
            open: function () {
                $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
            },
            close: function () {
                $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
            }
        });
        $("#textBox").autocomplete("option", "delay", 100);
    });
</script>


<iframe style="display:none" width="720" height="600" align="middle" id="myFrame">
    Ваш браузер не поддерживает плавающие фреймы!
</iframe>



<script>

    $(".weatherMap").on('click', function (e) {
        event.preventDefault();
        var elem = document.getElementById('myFrame');
        $(elem).css('display', 'block');
        let text = e.target.innerText;

        switch (text) {
            case 'Clouds map': {
                document.getElementById('myFrame').src =
                    "https://openweathermap.org/weathermap?basemap=map&cities=false&layer=clouds&lat=30&lon=-20&zoom=3";
                break;
            }
            case 'Precipitation map': {
                document.getElementById('myFrame').src =
                    "https://openweathermap.org/weathermap?basemap=map&cities=false&layer=precipitation&lat=30&lon=-20&zoom=3";
                break;
            }
            case 'Sea level pressure map': {
                document.getElementById('myFrame').src =
                    "https://openweathermap.org/weathermap?basemap=map&cities=false&layer=pressure&lat=30&lon=-20&zoom=3";
                break;
            }
            case 'Wind speed map': {
                document.getElementById('myFrame').src =
                    "https://openweathermap.org/weathermap?basemap=map&cities=false&layer=windspeed&lat=30&lon=-20&zoom=3";
                break;
            }
            case 'Temperature map': {
                document.getElementById('myFrame').src =
                    "https://openweathermap.org/weathermap?basemap=map&cities=false&layer=temperature&lat=30&lon=-20&zoom=3";
                break;
            }
        }
    })


    $(':checkbox').on('change', function () {
        if ($("#night").prop("checked")) {
            //$("body").css("background-color", "black");
            $("body").addClass("body_dark");
            $("h2").addClass("title-dark");
            $("input").addClass("button-dark");
            $("button").addClass("button-dark");
        } else {
            $("body").removeClass("body_dark");
            $("h2").removeClass("title-dark");
            $("input").removeClass("button-dark");
            $("button").removeClass("button-dark");

        }
    });

    $(function () {
        $('#formCity').submit(function (e) {
            var $form = $(this);
            $.ajax({
                type: $form.attr('method'),
                url: $form.attr('action'),
                data: $form.serialize()
            }).done(function (data) {

                $('#result').html(data)
            }).fail(function (jqXHR, exception) {
                var msg = '';
                var elem = document.getElementById("textBox");
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].Bad connection';
                    if (elem.value.length == 0) {
                        msg = 'Enter City Name';
                    } else if (elem.value.length > 0) {
                        msg = 'Incorrect City Name';
                    }
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                alert(msg);
            });
            e.preventDefault();
        });
    }());

    $(function () {
        $('#weather4Days').submit(function (e) {
            var $form = $(this);
            $.ajax({
                type: $form.attr('method'),
                url: $form.attr('action'),
                data: $form.serialize()
            }).done(function (data) {
                $('#result2').html(data)
            }).fail(function (jqXHR, exception) {
                var msg = '';
                var elem = document.getElementById("textBox5days");
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                    if (elem.value.length == 0) {
                        msg = 'Enter City Name';
                    } else if (elem.value.length > 0) {
                        msg = 'Incorrect City Name';
                    }
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                alert(msg);
            });
            e.preventDefault();
        });
    }());

    $('#Ref').click(function (event) {
        event.preventDefault();
        $.ajax({
            url: $(this).attr('href'),
            success: function (response) {
                current = document.getElementById("textBox5days");
                current2 = document.getElementById("textBox");
                current.value = response;
                current2.value = response;
            }, error: function (jqXHR, exception) {
                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].Bad connection';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                alert(msg);
            }
        });
        return false; // for good measure
    });

    $('#Ref2').click(function (event) {
        event.preventDefault();
        $.ajax({
            url: $(this).attr('href'),
            success: function (response) {
                var current = document.getElementById("textBox");
                current.value = response;
            }, error: function (jqXHR, exception) {
                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                alert(msg);
            }
        });
        return false; // for good measure
    });

</script>

